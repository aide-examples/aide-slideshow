<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Slideshow Control</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 400px; margin: 0 auto; }
        h1 {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #e94560;
        }
        .status-card {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .status-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .status-row:last-child { border-bottom: none; }
        .status-label { color: #888; }
        .status-value { font-weight: 600; }
        .status-value.on { color: #4ade80; }
        .status-value.off { color: #f87171; }
        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            background: #e94560;
            color: #fff;
            border: none;
            border-radius: 10px;
            padding: 15px 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        button:hover { background: #ff6b6b; transform: scale(1.02); }
        button:active { transform: scale(0.98); }
        button.secondary { background: #0f3460; }
        button.secondary:hover { background: #1a4a7a; }
        button.wide { grid-column: span 3; }
        button.half { grid-column: span 1; }
        .icon { font-size: 1.5rem; }
        .speed-control {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .speed-control label { display: block; margin-bottom: 10px; color: #888; }
        .speed-row { display: flex; align-items: center; gap: 10px; }
        .speed-row button { flex: 0 0 50px; padding: 10px; }
        .speed-value {
            flex: 1;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
        }
        .folders {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
        }
        .folders h3 { margin-bottom: 10px; color: #888; font-size: 0.9rem; }
        .file-manager-link {
            display: block;
            margin-top: 12px;
            color: #e94560;
            text-decoration: none;
            font-size: 0.85rem;
        }
        .file-manager-link:hover { text-decoration: underline; }
        .folder-list { display: flex; flex-wrap: wrap; gap: 8px; }
        .folder-btn {
            background: #0f3460;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        .folder-btn.active { background: #e94560; }
        .refresh-note {
            text-align: center;
            color: #666;
            font-size: 0.75rem;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Slideshow Control</h1>

        <div class="status-card">
            <div class="status-row">
                <span class="status-label">Status</span>
                <span class="status-value" id="status-paused">Loading...</span>
            </div>
            <div class="status-row">
                <span class="status-label">Monitor</span>
                <span class="status-value" id="status-monitor">--</span>
            </div>
            <div class="status-row">
                <span class="status-label">Images</span>
                <span class="status-value" id="status-playlist">--</span>
            </div>
            <div class="status-row">
                <span class="status-label">Filter</span>
                <span class="status-value" id="status-filter">--</span>
            </div>
        </div>

        <div class="controls">
            <button onclick="api('pause')" class="secondary">
                <span class="icon">‚è∏</span> Pause
            </button>
            <button onclick="api('resume')">
                <span class="icon">‚ñ∂</span> Play
            </button>
            <button onclick="api('skip')" class="secondary">
                <span class="icon">‚è≠</span> Skip
            </button>
            <button onclick="api('monitor/on')" class="secondary">
                <span class="icon">üì∫</span> Mon ON
            </button>
            <button onclick="api('monitor/off')" class="secondary">
                <span class="icon">üåô</span> Mon OFF
            </button>
            <button onclick="refreshStatus()" class="secondary">
                <span class="icon">üîÑ</span> Refresh
            </button>
        </div>

        <div class="speed-control">
            <label>Display Duration</label>
            <div class="speed-row">
                <button onclick="changeDuration(-5)" class="secondary">‚àí5</button>
                <div class="speed-value"><span id="duration">--</span>s</div>
                <button onclick="changeDuration(5)" class="secondary">+5</button>
            </div>
        </div>

        <div class="folders">
            <h3>Filter by Folder</h3>
            <div class="folder-list" id="folder-list">
                <button class="folder-btn" onclick="clearFilter()">All</button>
            </div>
            <a id="file-manager-link" href="#" target="_blank" class="file-manager-link">Dateiverwaltung √∂ffnen</a>
            <a href="/prepare" class="file-manager-link">Image Preparation</a>
            <a href="/about" class="file-manager-link">About / Documentation</a>
        </div>

        <p class="refresh-note">Auto-refreshes every 5 seconds</p>
    </div>

    <script>
        let currentDuration = 35;
        let currentFilter = null;

        async function api(endpoint) {
            try {
                const res = await fetch('/' + endpoint);
                const data = await res.json();
                refreshStatus();
                return data;
            } catch (e) {
                console.error('API error:', e);
            }
        }

        async function refreshStatus() {
            try {
                const res = await fetch('/status');
                const data = await res.json();

                document.getElementById('status-paused').textContent =
                    data.paused ? 'Paused' : 'Playing';
                document.getElementById('status-paused').className =
                    'status-value ' + (data.paused ? 'off' : 'on');

                document.getElementById('status-monitor').textContent =
                    data.monitor_on ? 'ON' : 'OFF';
                document.getElementById('status-monitor').className =
                    'status-value ' + (data.monitor_on ? 'on' : 'off');

                document.getElementById('status-playlist').textContent =
                    data.playlist_size + ' remaining';

                currentFilter = data.filter;
                document.getElementById('status-filter').textContent =
                    data.filter || 'None';

                currentDuration = data.display_duration;
                document.getElementById('duration').textContent = currentDuration;

                updateFolderButtons();
            } catch (e) {
                console.error('Status error:', e);
            }
        }

        async function loadFolders() {
            try {
                const res = await fetch('/folders');
                const data = await res.json();
                const list = document.getElementById('folder-list');
                list.innerHTML = '<button class="folder-btn" onclick="clearFilter()">All</button>';
                data.folders.forEach(folder => {
                    const btn = document.createElement('button');
                    btn.className = 'folder-btn';
                    btn.textContent = folder.split('/').pop();
                    btn.title = folder;
                    btn.onclick = () => setFilter(folder);
                    list.appendChild(btn);
                });
            } catch (e) {
                console.error('Folders error:', e);
            }
        }

        function updateFolderButtons() {
            document.querySelectorAll('.folder-btn').forEach(btn => {
                const isAll = btn.textContent === 'All';
                const isActive = isAll ? !currentFilter : btn.title === currentFilter;
                btn.classList.toggle('active', isActive);
            });
        }

        async function setFilter(folder) {
            await fetch('/filter?folder=' + encodeURIComponent(folder));
            refreshStatus();
        }

        async function clearFilter() {
            await fetch('/filter/clear');
            refreshStatus();
        }

        async function changeDuration(delta) {
            currentDuration = Math.max(5, Math.min(120, currentDuration + delta));
            await fetch('/duration?seconds=' + currentDuration);
            document.getElementById('duration').textContent = currentDuration;
        }

        // Set file manager link dynamically
        document.getElementById('file-manager-link').href =
            window.location.protocol + '//' + window.location.hostname + ':8081';

        // Initial load
        refreshStatus();
        loadFolders();

        // Auto-refresh every 5 seconds
        setInterval(refreshStatus, 5000);
    </script>
</body>
</html>
